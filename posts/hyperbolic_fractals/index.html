<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="George Stagg">
<meta name="dcterms.date" content="2021-06-27">
<meta name="description" content="The Mandelbrot Set living on a Poincaré disc.">

<title>Hyperbolic fractals – Dr George W Stagg</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/george_stagg.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Hyperbolic fractals – Dr George W Stagg">
<meta property="og:description" content="The Mandelbrot Set living on a Poincaré disc.">
<meta property="og:image" content="https://gws.phd/posts/hyperbolic_fractals/hyper_m.png">
<meta property="og:site_name" content="Dr George W Stagg">
<meta property="og:image:height" content="900">
<meta property="og:image:width" content="1600">
<meta name="twitter:title" content="Hyperbolic fractals – Dr George W Stagg">
<meta name="twitter:description" content="The Mandelbrot Set living on a Poincaré disc.">
<meta name="twitter:image" content="https://gws.phd/posts/hyperbolic_fractals/hyper_m.png">
<meta name="twitter:creator" content="@gwstagg">
<meta name="twitter:site" content="@gwstagg">
<meta name="twitter:image-height" content="900">
<meta name="twitter:image-width" content="1600">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../education.html"> 
<span class="menu-text">Education</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software &amp; Demos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/thesis_gws.pdf"> 
<span class="menu-text">Thesis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hyperbolic fractals</h1>
  <div class="quarto-categories">
    <div class="quarto-category">maths</div>
    <div class="quarto-category">webgl</div>
  </div>
  </div>

<div>
  <div class="description">
    The Mandelbrot Set living on a Poincaré disc.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>George Stagg </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 27, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>To skip the maths and play with an interactive fractal browser, click <a href="#explorer">here</a>!</p>
<section id="the-mandelbrot-set" class="level3">
<h3 class="anchored" data-anchor-id="the-mandelbrot-set">The Mandelbrot Set</h3>
<p>
The <b>Mandelbrot set</b> is probably one of the most famous fractals, known for its <a href="https://www.youtube.com/watch?v=PD2XgQOyCCk">self-similar deep zooms</a> and often demonstrated as an example of mathematical beauty.
</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mandelbrot_small.jpg" class="card-img-top img-fluid figure-img" alt="A view of the entire Mandelbrot Set."></p>
<figcaption>The Mandelbrot set smoothly coloured by iteration.</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mandelbrot_small2.jpg" class="card-img-top img-fluid figure-img" alt="A zoomed view of the Mandelbrot Set."></p>
<figcaption>A partial zoomed view of the Mandelbrot set at coordinates (-0.7436,0.1314).<br>
<small>Both images generated by <a href="https://commons.wikimedia.org/wiki/User:Wolfgangbeyer">Wolfgang Beyer</a></small>.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>Mathematically, the Mandelbrot set is the set of values <span class="math inline">\(c\in\mathbb{C}\)</span> for which the absolute value of the terms in the sequence, <span class="math display">\[z_0=0,\quad z_{n+1} = z_n^2 + c,\tag{1} \]</span> doesn’t fly off to infinity. Equation <span class="math inline">\((1)\)</span> is known as the <b>orbit function</b> for the Mandelbrot set. For example, when <span class="math inline">\(c=1\)</span>, the sequence reads <span class="math inline">\(z_n = 0, 1, 2, 5, 26, \dots\)</span> This sequence in this particular case tends towards infinity and so <span class="math inline">\(c=1\)</span> is not in the Mandelbrot set.</p>
<p>One can display all the points in the set on a complex plane to see a basic plot of the famous Mandelbrot shape, but normally a plot is instead produced of the number of iterations before <span class="math inline">\(|z_n|\)</span> is greater than some threshold value. In the above images the iteration count is <a href="https://www.iquilezles.org/www/articles/mset_smooth/mset_smooth.htm">further smoothed</a> using some extra mathematical tricks.</p>
</section>
<section id="interpreting-the-process-geometrically" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-process-geometrically">Interpreting the Process Geometrically</h3>
<p>When plotting the Mandelbrot set we are associating complex values to points in the 2D plane. The Cartesian coordinates associated with a point <span class="math inline">\(z\)</span> are <span class="math inline">\((z_x, z_y)\)</span>, with <span class="math display">\[ z = z_x + iz_y, \]</span> but an equivalent way of associating <span class="math inline">\(z\)</span> to a point in the plane is by using 2D polar coordinates <span class="math inline">\((z_r,z_\theta)\)</span>, with <span class="math display">\[ z = z_re^{iz_\theta}.\]</span> Here <span class="math inline">\(z_r\)</span> is the distance from the origin to the point and <span class="math inline">\(z_\theta\)</span> is the angle of the point in relation to the <span class="math inline">\(x\)</span> axis. The two systems are related by, <span class="math display">\[ z_x = z_r\cos(z_\theta),\quad z_y=z_r\sin(z_\theta). \tag{2} \]</span> We can use the Cartesian and polar coordinate systems shown in Equation <span class="math inline">\((2)\)</span> to reinterpret the operations used in Equation <span class="math inline">\((1)\)</span> geometrically.</p>
<p>First, consider the addition operation. This is easily understood by writing the operation in Cartesian form, <span class="math display">\[z + c \rightarrow (z_x + c_x, z_y+c_y).\]</span></p>
<p>Geometrically, the operation has the effect of translating the point in the <span class="math inline">\(x\)</span> direction by a distance of <span class="math inline">\(c_x\)</span> and in the <span class="math inline">\(y\)</span> direction by a distance of <span class="math inline">\(c_y\)</span>. Note that another geometric way of getting to the same point is by first rotating the point associated with <span class="math inline">\(z\)</span> about the origin by <span class="math inline">\(-c_\theta\)</span>, translating it in the <span class="math inline">\(x\)</span> direction by <span class="math inline">\(c_r\)</span>, and then finally rotating back about the origin by <span class="math inline">\(c_\theta\)</span>.</p>
<p>Now consider the operation <span class="math inline">\(z^2 = z \cdot z\)</span>. Rewriting the complex number <span class="math inline">\(z\)</span> in 2D polar form and then simplifying, <span class="math display">\[ z^2 = z_re^{iz_\theta} \cdot z_re^{iz_\theta} = z_r^2e^{i2z_\theta}. \]</span> This is still in polar form and shows that the operation <span class="math inline">\(z^2\)</span> takes the point associated with <span class="math inline">\(z\)</span>, rotates it about the origin by <span class="math inline">\(z_\theta\)</span>, and then dilates by <span class="math inline">\(z_r\)</span> so that the distance of the point from the origin is squared. Again, there is an alternative geometric method to get to the same point: First take the origin point, translate it in the <span class="math inline">\(x\)</span> direction by <span class="math inline">\(z_r^2\)</span> and then rotate around the origin by <span class="math inline">\(2z_\theta\)</span>.</p>
<p>Using the alternative interpretations above, we can think of Equation <span class="math inline">\((1)\)</span> as a set of translations along <span class="math inline">\(x\)</span> and rotations around the origin. Given a value for <span class="math inline">\(z\)</span> and <span class="math inline">\(c\)</span> we can calculate the result of applying Equation <span class="math inline">\((1)\)</span> by finding the complex value associated with the point obtained by applying the following geometric process:</p>
<ol type="1">
<li>Take the origin point and translate it by <span class="math inline">\(z_r^2\)</span> in the <span class="math inline">\(x\)</span> direction.</li>
<li>Rotate around the origin by <span class="math inline">\(2z_\theta-c_\theta\)</span>.</li>
<li>Translate by <span class="math inline">\(c_r\)</span> in the <span class="math inline">\(x\)</span> direction.</li>
<li>Rotate around the origin by <span class="math inline">\(c_\theta\)</span>.</li>
</ol>
<p>
Later, we will use a similar geometric process to define a hyperbolic version of Equation <span class="math inline">\((1)\)</span>, set in curved space rather than the standard flat Euclidean space. Since the overall structure of the Mandelbrot set results from the algebra of the complex numbers that we are mimicking with a geometric process, things should not look <i>super</i> different, but with in curved space moving around and zooming into details should at least look fairly interesting.
</p>
</section>
<section id="hyperbolic-space" class="level3">
<h3 class="anchored" data-anchor-id="hyperbolic-space">Hyperbolic Space</h3>
<p>Hyperbolic n-space, denoted <span class="math inline">\(\mathbf{H}^n\)</span>, is a homogeneous space that has a constant negative curvature. Curvature here specifically means Gaussian curvature intrinsic to the surface and is a measure of how much geometric objects and operations on the surface deviates from the behaviour in flat space (zero curvature).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="space_lines.png" class="card-img-top img-fluid figure-img" alt="Examples of Gaussian curvature"></p>
<figcaption>Examples of different types of Gaussian curvature. <small>Image created by <a href="http://www.science4all.org/article/brazuca/">Science4All</a></small></figcaption>
</figure>
</div>
<p>
To visualise curved space we need to be able to somehow convert it for display in 2D or 3D Euclidean space, so that it can be sensibly displayed on your screen. However, <a href="https://en.wikipedia.org/wiki/Hilbert%27s_theorem_(differential_geometry)">Hilbert’s theorem</a> says that we can’t embed even a small part of hyperbolic space into 3D Euclidean space due to its constant negative curvature. Luckily, there are several so-called <i>models</i> of hyperbolic space that we can use instead. These models are simply different ways of expressing the structure of hyperbolic space mathematically. We will be using two models: our main calculations will be made in the <b>Hyperboloid Model</b> and we will visualise the result later using the <b>Poincaré Disc Model</b>.
</p>
<h4 class="anchored">
The Hyperboloid Model
</h4>
<p>
The <b>Hyperboloid Model</b> is a model of n-dimensional hyperbolic geometry in which points are associated with points on a hyperboloid surface living in an (n+1)-dimensional non-Euclidean space. A hyperbolic distance function is defined on the surface so that hyperbolic geometry is preserved.
</p>
<p>
Often <b>Minkowski space</b> is used here due to its useful applications in the theory of special relativity. However, I will instead use <b>Lorentz space</b>. It is essentially the same — the coordinates are just re-ordered and some signs are flipped. It doesn’t change the behaviour of the space but does avoid references to physical “time-like” and “space-like” dimensions.
</p>
<p>
We begin defining Lorentz space by writing down an inner product. For vectors <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> in <span class="math inline">\(\mathbb{R}^d\)</span> the <b>Lorentzian inner product</b> is, <span class="math display">\[\mathbf{u} \cdot \mathbf{v} = u_1v_1 + u_2v_2 + \dots - u_dv_d.\]</span> This looks very similar to the standard Euclidean inner product expect for the subtraction of the final components. This definition is valid for any vectors <span class="math inline">\(\mathbb{R}^d\)</span> but we’ll only really consider the case when <span class="math inline">\(d=3\)</span> and denote that space as <span class="math inline">\(\mathbb{L}^{2,1}\)</span>, Lorentz (2,1)-space. Following on from the inner product, we can define both the <b>Lorenz norm</b> and <b>Lorentz distance</b> between two vectors,<span class="math display">\[ ||\mathbf{u}|| = \sqrt{\mathbf{u} \cdot \mathbf{u}}, \]</span> <span class="math display">\[ d_L(\mathbf{u},\mathbf{v}) = || \mathbf{u} - \mathbf{v} ||. \]</span>
</p>
<p>
Now, to recreate the geometry of hyperbolic space we need a surface, <span class="math inline">\(\mathcal{H}\)</span>, with constant negative curvature. A sphere with radius <span class="math inline">\(r\)</span> can be shown to have a curvature of <span class="math inline">\(\kappa = \frac{1}{r^2}\)</span>, so if we could somehow construct a sphere with a radius of <span class="math inline">\(r = \sqrt{-1}\)</span>, we would immediately satisfy our requirements. In analogy to the definition of an <a href="https://en.wikipedia.org/wiki/N-sphere">n-sphere</a> in Euclidean space we form our surface, <span class="math display">\[\mathcal{H} =\{\mathbf{u} \in \mathbb{L}^{2,1} : ||\mathbf{u}|| = i\}.\]</span>
</p>
<p>
In Euclidean space this is impossible, but as it turns out such a sphere can exist in <span class="math inline">\(\mathbb{L}^{2,1}\)</span> consisting of all the points <span class="math inline">\(\mathbf{u}\)</span> satisfying the equation <span class="math inline">\(u_1^2+u_2^2-u_3^2 = -1.\)</span> Back in Euclidean space, this is a two-sheeted hyperboloid and we choose to define our hyperboloid model on the positive sheet only, with <span class="math inline">\(u_3&gt;0.\)</span>
</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="hyperbolid0.png" class="card-img-top img-fluid figure-img" alt="A two-sheeted hyperbolid."></p>
<figcaption>A two-sheeted hyperbolid visualised in 3D Euclidean space. <small>Created by <a href="https://commons.wikimedia.org/wiki/File:Hyperboloid2.png">Lars H. Rohwedder</a></small>.</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="hyperbolid1.png" class="card-img-top img-fluid figure-img" alt="The hyperbolid model showing geodesic lines."></p>
<figcaption>The hyperboloid model showing red geodesics, which can be thought of as generalised “straight lines” on the surface. <small>Created by <a href="https://www.brice.loustau.eu/teaching/TUDarmstadt/HyperbolicGeometry2019/">Brice Loustau</a></small></figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>The last piece needed to ensure hyperbolic geometry is enforced on the surface of <span class="math inline">\(\mathcal{H}\)</span> is a <b>hyperbolic distance function</b>, which we define as <span class="math display">\[d_\mathcal{H}(\mathbf{u},\mathbf{v}) = \mathop{\text{arccosh}
}(-\mathbf{u} \cdot \mathbf{v}),\]</span> so that for any vectors <span class="math inline">\(\mathbf{u},\mathbf{v} \in \mathcal{H}\)</span>, <span class="math display">\[\mathbf{u}\cdot \mathbf{v} = ||\mathbf{u}||.||\mathbf{v}||.\cosh\left(d_\mathcal{H}(\mathbf{u},\mathbf{v})\right),\]</span> in analogy to the geometric formulation of the Euclidean dot product. It’s fairly easy to show that <span class="math inline">\(d_\mathcal{H}\)</span> satisfies all the criteria to be a metric on the hyperboloid, but I won’t go into all the details here.</p>
</section>
<section id="hyperbolic-mandelbrot-set" class="level3">
<h3 class="anchored" data-anchor-id="hyperbolic-mandelbrot-set">Hyperbolic Mandelbrot Set</h3>
<section id="lorentz-transformations" class="level4">
<h4 class="anchored" data-anchor-id="lorentz-transformations">Lorentz Transformations</h4>
<p>In the first section we defined the Mandelbrot set in terms of translations and rotations. These operations are really maps from the plane <span class="math inline">\(\mathbb{R}^2\)</span> back to itself, such that the Euclidean distance between points does not change. To create a hyperbolic analogue we need similar transformations for hyperbolic space. The <a href="https://en.wikipedia.org/wiki/Lorentz_group">Lorentz group</a> forms a set of transformations for <span class="math inline">\(\mathbb{L}^{n}\)</span> that preserves the hyperbolic distance function in exactly the way we need. There are three types of Lorentz transforms (not including the <b>identity</b>) that make up the group. <b>Parabolic</b>, <b>hyperbolic</b>, and <b>elliptic</b>.</p>
<p>The elliptic transformations behave essentially the same as Euclidean rotations, defined in terms of an angle. The transformation preserves both the distance between points and the distance between all points and the origin. In the case of the 2D hyperboloid model a rotation of <span class="math inline">\(\theta\)</span> looks like this, <span class="math display">\[
R(\theta) \mathbf{u} = \begin{bmatrix}
\cos(\theta) &amp; -\sin(\theta) &amp; 0 \\
\sin(\theta) &amp;  \cos(\theta) &amp; 0 \\
0 &amp; 0            &amp;  1
\end{bmatrix} \begin{bmatrix}
u_1 \\ u_2 \\ u_3
\end{bmatrix}
\]</span></p>
<p>The hyperbolic transformations are similar to Euclidean translations along an axis. They preserve the distance between points, but not the distance between points and the origin. This type of transformation is called a <b>boost</b> and is defined in terms of a <b>hyperbolic angle</b>, also known as the <b>rapidity</b>. In the case of the 2D hyperboloid model a boost with rapidity <span class="math inline">\(\eta\)</span> looks like this: <span class="math display">\[
T(\eta) \mathbf{u} = \begin{bmatrix}
\cosh(\eta) &amp; 0 &amp; \sinh(\eta) \\
0 &amp; 1 &amp; 0 \\
\sinh(\eta) &amp; 0 &amp; \cosh(\eta) \\
\end{bmatrix} \begin{bmatrix}
u_1 \\ u_2 \\ u_3
\end{bmatrix}
\]</span></p>
<p>The parabolic transformations don’t really have any analogue in Euclidean space, and so we won’t be using them. They do have use in the theory of special relativity and there they are often called <b>null rotations</b>. In case you’re interested, they look like this:</p>
<p><span class="math display">\[
N(\alpha) \mathbf{u} = \begin{bmatrix}
1-\frac{\alpha^2}{2} &amp;  -\alpha &amp; \frac{\alpha^2}{2} &amp;\\
\alpha &amp; 1 &amp; -\alpha\\
-\frac{a^2}{2} &amp; -\alpha &amp; 1+\frac{\alpha^2}{2}
\end{bmatrix}\begin{bmatrix}
u_1 \\ u_2 \\ u_3
\end{bmatrix}
\]</span></p>
</section>
<section id="hyperbolic-analogue-of-the-orbit-function" class="level4">
<h4 class="anchored" data-anchor-id="hyperbolic-analogue-of-the-orbit-function">Hyperbolic Analogue of the Orbit Function</h4>
<p>We now use the above transformations to recreate the geometric process of Equation <span class="math inline">\((1)\)</span>, the orbit function for the Mandelbrot set, with hyperbolic transformations. We first replace Euclidean rotations with Lorentzian rotations and Euclidean translations with boosts. We define analogies to the polar coordinates of <span class="math inline">\(\mathbf{u}\)</span> in the following way, <span class="math display">\[u_\eta = d_\mathcal{H}(\mathbf{u}, \mathbf{0}),\quad u_\theta = \mathop{\text{arctan}}\left(\frac{u_2}{u_1}\right). \]</span></p>
<p>The result is the following construction for Equation <span class="math inline">\((1)\)</span>: Given a <span class="math inline">\(\mathbf{u}, \mathbf{c} \in \mathcal{H}\)</span>, calculate the point on <span class="math inline">\(\mathcal{H}\)</span> obtained by applying the following geometric process:</p>
<ol type="1">
<li>Take the origin point, <span class="math inline">\(\mathbf{0} = (0,0,1)\)</span>, and boost it by <span class="math inline">\(u_\eta^2\)</span>.</li>
<li>Rotate around the origin by <span class="math inline">\(2u_\theta-c_\theta\)</span>.</li>
<li>Boost by <span class="math inline">\(c_\eta\)</span>.</li>
<li>Rotate around the origin by <span class="math inline">\(c_\theta\)</span>.</li>
</ol>
<p>The rest of the process of defining the Mandelbrot set remains the same. Note that the process can be trivially extended to other similar fractals based on orbit functions on the complex plane. For example, the method above can also be used to generate <b>Julia set</b> fractals.</p>
</section>
</section>
<section id="visualisation" class="level3">
<h3 class="anchored" data-anchor-id="visualisation">Visualisation</h3>
<p>The Poincaré Disc model</p>
<p>Visualising the hyperboloid model is difficult due to the fact that while the surface is two-dimensional, the hyperboloid itself lives in a three-dimensional Lorenz space. One option could be to simply visualise the hyperboloid surface in 3D, as if it were living in <span class="math inline">\(\mathbb{R^3}\)</span>, and projecting down to your 2D screen in the standard way. However, this would make manipulating the view and getting an intuition for how hyperbolic space really behaves rather difficult since we lose any way to express the hyperbolic distance. Instead, we will project the hyperboloid model down to 2D using the <a href="https://en.wikipedia.org/wiki/Poincaré_disk_model">Poincaré Disc model</a>.</p>
<p>In this model the entire hyperboloid surface is stereoscopically projected to, and drawn inside, a circular disc. An interesting consequence of this is that you can see the entirety of the infinite surface all at once. It all “fits” because as you move towards the outer boundary the hyperbolic distance between points grows exponentially and features shrink away into nothingness. Using a Poincaré disc neatly demonstrates the different geometries possible in hyperbolic space. For example, you can easily show a tiling of the hyperbolic plane with heptagons while such a tiling is impossible in the Euclidean plane.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="poincare_disc.png" class="card-img-top img-fluid figure-img" alt="Figure showing a projection from a hyperboloid durface to a flat disc."></p>
<figcaption>Stereoscopic projection from the hyperboloid model to the Poincaré disc, showing how a geodesic maps from one to the other. <small>Created by <a href="https://commons.wikimedia.org/wiki/File:HyperboloidProjection.png">Selfstudier</a></small>.</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="poincare_tiling.png" class="card-img-top img-fluid figure-img" alt="Heptagons tiling the hyperbolic plane."></p>
<figcaption>Heptagons uniformly tiling the hyperbolic plane, shown in the form of a Poincaré disc. <small>Created by <a href="https://commons.wikimedia.org/wiki/File:H2_tiling_237-1.png">Anton Sherwood</a></small>.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>The process to stereoscopically project the hyperboloid model to the Poincaré disc is not too difficult. Starting with a point <span class="math inline">\(\mathbf{u}\)</span> on the hyperboloid, a line is drawn between <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{N} = (0,0,-1)\)</span>, intersecting the <span class="math inline">\(z=0\)</span> plane at the required point <span class="math inline">\(\mathbf{p} = (p_1, p_2)\)</span> on the Poincaré disc. This procedure leads to the following relationship between the points <span class="math inline">\(\mathbf{u} = (u_1, u_2, u_3)\)</span> on the hyperboloid and <span class="math inline">\(\mathbf{p} = (p_1, p_2)\)</span> on the disc,<span class="math display">\[\mathbf{p} = \left( \frac{u_1}{u_3+1},  \frac{u_2}{u_3+1} \right),\quad \mathbf{u} = \frac{\left(2p_1, 2p_2, 1+p_1^2+p_2^2\right)}{1-p_2^2-p_2^2}.\]</span></p>
</section>
<section id="explorer" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="explorer">Hyperbolic Fractal Explorer</h3>
<p>I have created an interactive hyperbolic fractal explorer, shown below. Note that this demo runs using webGL and so the precision of the rotation calculations are fairly limited. The precision loss becomes readily apparent at higher levels of zoom. Nevertheless it’s a fun little demonstration of the ideas above.</p>
<p>In addition to the controls in the top right, click and drag to boost around. <code>W</code> will zoom in, <code>S</code> will zoom out and the <code>A</code> and <code>D</code> keys will also boost left and right.</p>
<div class="column-body-outset mb-3">
<iframe style="width:100%; height: 720px;" src="fractal/index.html">
</iframe>
</div>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>In addition to the links throughout, here is some more useful reading material.</p>
<ul>
<li><a href="http://www.maths.dur.ac.uk/Ug/projects/highlights/CM3/Hayter_Hyperbolic_report.pdf">The Hyperbolic plane: “A Strange New Universe”</a></li>
<li><a href="http://bjlkeng.github.io/posts/hyperbolic-geometry-and-poincare-embeddings/">Hyperbolic Geometry and Poincaré Embeddings</a></li>
<li><a href="https://math.stackexchange.com/questions/2668264/is-hyperbolic-rotation-really-a-rotation">Stack Overflow: Is hyperbolic rotation really a rotation?</a></li>
<li><a href="https://en.wikipedia.org/wiki/Hyperbolic_space">Wikipedia: Hyperbolic Space</a></li>
<li><a href="https://en.wikipedia.org/wiki/Poincaré_disk_model">Wikipedia: Poincare Disc</a></li>
<li><a href="https://iquilezles.org/www/articles/mset_1bulb/mset1bulb.htm">iq: The Main Bulb of the Mandelbrot Set</a></li>
<li><a href="https://www.iquilezles.org/www/articles/mset_smooth/mset_smooth.htm">iq: Smooth Iteration Count for Generalized Mandelbrot Sets</a></li>
<li><a href="http://roguetemple.com/z/hyper/models.php">Hyperogue: Models and projections of hyperbolic geometry</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/gws\.phd");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>