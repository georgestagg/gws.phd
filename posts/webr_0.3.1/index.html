<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="George Stagg">
<meta name="dcterms.date" content="2024-04-02">
<meta name="description" content="WebR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what’s new in this release.">

<title>Dr George W Stagg - WebR 0.3.1 has been released</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/george_stagg.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Dr George W Stagg - WebR 0.3.1 has been released">
<meta property="og:description" content="WebR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what’s new in this release.">
<meta property="og:image" content="https://gws.phd/posts/webr_0.3.1/thumbnail.jpeg">
<meta property="og:site_name" content="Dr George W Stagg">
<meta name="twitter:title" content="Dr George W Stagg - WebR 0.3.1 has been released">
<meta name="twitter:description" content="WebR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what’s new in this release.">
<meta name="twitter:image" content="https://gws.phd/posts/webr_0.3.1/thumbnail.jpeg">
<meta name="twitter:creator" content="@gwstagg">
<meta name="twitter:site" content="@gwstagg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../education.html"> 
<span class="menu-text">Education</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software &amp; Demos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/thesis_gws.pdf"> 
<span class="menu-text">Thesis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">WebR 0.3.1 has been released</h1>
  <div class="quarto-categories">
    <div class="quarto-category">programming</div>
    <div class="quarto-category">r</div>
    <div class="quarto-category">wasm</div>
    <div class="quarto-category">webr</div>
  </div>
  </div>

<div>
  <div class="description">
    WebR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what’s new in this release.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>George Stagg </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
<style>
  .CodeMirror pre {
    background-color: unset !important;
  }
  .btn-webr {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/r/r.js"></script>
<script type="module">
  import { WebR, ChannelType } from 'https://webr.r-wasm.org/v0.3.1/webr.mjs';
  globalThis.webR = new WebR({
    channelType: ChannelType.PostMessage,
  });
  await globalThis.webR.init();
  await webR.evalRVoid("webr::shim_install()");
  await webR.evalRVoid("webr::global_prompt_install()", { withHandlers: false });
  globalThis.webRCodeShelter = await new globalThis.webR.Shelter();
  document.querySelectorAll(".btn-webr").forEach((btn) => {
    btn.innerText = 'Run code';
    btn.disabled = false;
  });
</script>
<p>This post was originally published as an article on the <a href="https://www.tidyverse.org/blog/2024/04/webr-0-3-1/">Tidyverse Blog</a>.</p>
<!-- Custom styles for output -->
<div class="highlight">
<style type="text/css">
.output > pre, .output code {
  background-color: #ffffff !important;
}

.error > pre, .error code {
  background-color: #fcebeb !important;
  color: #410E0E !important;
}
</style>
</div>
<p>We’re delighted to announce the release of <a href="https://docs.r-wasm.org/webr/latest/">webR</a> 0.3.1. This release brings bug fixes, infrastructure upgrades, and exciting improvements to webR’s API for creating R objects and evaluating R code from JavaScript. These new features make integrating webR with existing JavaScript frameworks such as <a href="https://observablehq.com">Observable</a> a breeze.</p>
<p>You can install the latest release from <a href="https://www.npmjs.com/package/webr">npm</a> with the command:</p>
<pre><code>npm i webr@0.3.1</code></pre>
<p>or if you’re using JavaScript modules to import webR directly from CDN:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { WebR } <span class="im">from</span> <span class="st">'https://webr.r-wasm.org/v0.3.1/webr.mjs'</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A summary of changes is described below, with the full <a href="https://github.com/r-wasm/webr/releases">release notes</a> on GitHub.</p>
<section id="evaluating-r-code-from-javascript" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="evaluating-r-code-from-javascript">Evaluating R code from JavaScript</h2>
<p>The underlying interpreter powering webR is built from the same source code as R itself, with patches applied so that it can run in the WebAssembly environment. With this release, we have rebased our patches on the latest stable version of R<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. By keeping our source in sync, improvements and bug fixes made by the R Core Team also benefit any project making use of webR.</p>
<div class="no-row-height column-margin column-container"><p><sup>1</sup>&nbsp;The latest stable release at the time of writing: <a href="https://cran.rstudio.com/doc/manuals/r-release/NEWS.html">R 4.3.3 — “Angel Food Cake”</a></p></div><p>WebR’s core functionality is to evaluate R code from a JavaScript environment. As such, it is imperative that this works well, even with large and complex scripts. The <a href="https://webr.r-wasm.org/v0.3.1/">webR app</a> has been updated to better handle large R scripts, and scripts longer than 4096 characters should no longer cause strange issues in the R console.</p>
<section id="loading-webassembly-packages" class="level3">
<h3 class="anchored" data-anchor-id="loading-webassembly-packages">Loading WebAssembly packages</h3>
<p>The package management functions provided by webR have been expanded and improved. We set up webR with shims (interceptors) for <a href="https://rdrr.io/r/utils/install.packages.html"><code>install.packages()</code></a>, <a href="https://rdrr.io/r/base/library.html"><code>library()</code></a>, and <a href="https://rdrr.io/r/base/library.html"><code>require()</code></a> so that installing or loading R packages automatically downloads WebAssembly binaries from the <a href="https://repo.r-wasm.org">webR package repository</a>. Also, it is no longer required to run the <a href="https://rdrr.io/r/base/library.html"><code>library()</code></a> command a second time to subsequently load the package.</p>
<p>In this interactive example, webR is configured to automatically install WebAssembly packages. Click “Run code” to download the packages listed in the R script.</p>
<button class="btn btn-default btn-webr" disabled="" type="button" id="webr-run-button-1">
Loading webR…
</button>
<div id="webr-editor-1">

</div>
<div id="webr-code-output-1">
<pre style="visibility: hidden"></pre>
</div>
<script type="module">
  const runButton = document.getElementById('webr-run-button-1');
  const outputDiv = document.getElementById('webr-code-output-1');
  const editorDiv = document.getElementById('webr-editor-1');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# Explicitly install wasm packages\ninstall.packages("cli")\n\n# Automatically install wasm packages\nlibrary(vctrs)\nrequire(jsonlite)\n\n# Confirm the packages installed successfully\nrownames(installed.packages())`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await globalThis.webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=360)');
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: webR.objs.emptyEnv,
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas' && msg.data.event === 'canvasImage'){
          if (!canvas) {
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 360);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
          }
          canvas.getContext('2d').drawImage(msg.data.image, 0,0,canvas.width,canvas.height)
        }
      });

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      if (canvas) {
        const p = document.createElement("p");
        p.appendChild(canvas);
        outputDiv.appendChild(p);
      }
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script>
<p>See the <a href="https://docs.r-wasm.org/webr/latest/packages.html">documentation</a> for more details on how to control this behaviour in your own webR-powered applications, including optionally showing an interactive download menu to the user.</p>
</section>
<section id="error-handling-and-reporting" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-and-reporting">Error handling and reporting</h3>
<p>Improvements have been made to how webR raises R conditions as JavaScript exceptions. Exceptions now include the offending source R call in the error message text, better matching what is shown in a traditional R console.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="st">"sin('abc')"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output error">
<pre><code>Uncaught Error: Error in sin("abc"): non-numeric argument to mathematical function</code></pre>
</div>
<p>Conditions raised when invoking function objects are now also re-thrown as JavaScript exceptions, rather than a generic <code>UnwindProtectException</code> error. Compare the error messages shown below from the previous and latest versions of webR to see the useful context added by this change.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// webR 0.2.2</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> do_calc <span class="op">=</span> <span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`function (n) { rnorm(n) }`</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">do_calc</span>(<span class="op">-</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output error">
<pre><code>Uncaught (in promise) UnwindProtectException: A non-local transfer of control occured during evaluation</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// webR 0.3.1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> do_calc <span class="op">=</span> <span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`function (n) { rnorm(n) }`</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">do_calc</span>(<span class="op">-</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output error">
<pre><code>Uncaught (in promise) Error: Error in rnorm(n): invalid arguments</code></pre>
</div>
<p>Some base R features can be problematic when running R under WebAssembly. For example, in the constrained WebAssembly sandbox the base R function <a href="https://rdrr.io/r/base/system.html"><code>system()</code></a> does not work. The latest release of webR now handles these cases more consistently, raising R <a href="https://rdrr.io/r/base/stop.html"><code>stop()</code></a> conditions rather than incorrectly returning an empty result.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># webR 0.3.1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output error">
<pre><code>Error in webr_hook_system(command) : 
  The "system()" function is unsupported under Emscripten.</code></pre>
</div>
</section>
</section>
<section id="capturing-html-canvas-graphics-output" class="level2">
<h2 class="anchored" data-anchor-id="capturing-html-canvas-graphics-output">Capturing HTML canvas graphics output</h2>
<p>The <a href="https://docs.r-wasm.org/webr/latest/evaluating.html#evaluating-r-code-and-capturing-output-with-capturer"><code>captureR()</code></a> function is designed to capture output generated when evaluating R code. In addition to capturing standard text output, details about errors and other R conditions are also captured. With this release, plots drawn using webR’s HTML canvas graphics device, <a href="https://rdrr.io/pkg/webr/man/canvas.html"><code>webr::canvas()</code></a>, are also captured and returned by default.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Evaluate R code, capturing all output</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> capture <span class="op">=</span> <span class="cf">await</span> webR<span class="op">.</span><span class="at">globalShelter</span><span class="op">.</span><span class="fu">captureR</span>(<span class="vs">`</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="vs">  x &lt;- rnorm(10000)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="vs">  print(x[1])</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="vs">  hist(x)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(capture)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output">
<pre><code>{
  result: Proxy(Object),
  output: [
    { type: 'stdout', data: '[1] 0.7612882' },
  ],
  images: [ ImageBitmap ],
}</code></pre>
</div>
<p>Captured plots are returned as an array of <a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap"><code>ImageBitmap</code></a> JavaScript objects in the <code>images</code> property. This interface represents a bitmap image in a way that can be efficiently drawn to a HTML <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas"><code>&lt;canvas&gt;</code></a> element.</p>
<p>This change makes plotting consistent with other forms of R output and simplifies the process when working with multiple independent R code blocks and output images. See the webR documentation on <a href="https://docs.r-wasm.org/webr/latest/evaluating.html#evaluating-r-code-and-capturing-output-with-capturer">evaluating R code</a> for further details, and this <a href="https://observablehq.com/d/ec99bb89a4c646ab">Observable notebook</a> for an example of capturing R plots from JavaScript.</p>
<section id="graphics-device-bug-fixes" class="level3">
<h3 class="anchored" data-anchor-id="graphics-device-bug-fixes">Graphics device bug fixes</h3>
<p>In addition to adding the ability to capture graphics output, the <a href="https://rdrr.io/pkg/webr/man/canvas.html"><code>webr::canvas()</code></a> graphics device has also had various bug fixes made to better implement R base graphics. The easiest way to demonstrate is probably by example:</p>
<button class="btn btn-default btn-webr" disabled="" type="button" id="webr-run-button-2">
Loading webR…
</button>
<div id="webr-editor-2">

</div>
<div id="webr-code-output-2">
<pre style="visibility: hidden"></pre>
</div>
<script type="module">
  const runButton = document.getElementById('webr-run-button-2');
  const outputDiv = document.getElementById('webr-code-output-2');
  const editorDiv = document.getElementById('webr-editor-2');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# The lty and lwd graphical properties now work correctly\nplot(1:10, type = "l", lty = 2, lwd = 3)\npoints(1:10, cex = 3, lwd = 2)`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await globalThis.webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=360)');
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: webR.objs.emptyEnv,
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas' && msg.data.event === 'canvasImage'){
          if (!canvas) {
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 360);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
          }
          canvas.getContext('2d').drawImage(msg.data.image, 0,0,canvas.width,canvas.height)
        }
      });

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      if (canvas) {
        const p = document.createElement("p");
        p.appendChild(canvas);
        outputDiv.appendChild(p);
      }
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script>
<button class="btn btn-default btn-webr" disabled="" type="button" id="webr-run-button-3">
Loading webR…
</button>
<div id="webr-editor-3">

</div>
<div id="webr-code-output-3">
<pre style="visibility: hidden"></pre>
</div>
<script type="module">
  const runButton = document.getElementById('webr-run-button-3');
  const outputDiv = document.getElementById('webr-code-output-3');
  const editorDiv = document.getElementById('webr-editor-3');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# The cex graphical property is now taken into account\n# when calculating font sizes\nplot(1, main = "This is a large title", cex.main = 3)`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await globalThis.webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=360)');
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: webR.objs.emptyEnv,
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas' && msg.data.event === 'canvasImage'){
          if (!canvas) {
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 360);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
          }
          canvas.getContext('2d').drawImage(msg.data.image, 0,0,canvas.width,canvas.height)
        }
      });

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      if (canvas) {
        const p = document.createElement("p");
        p.appendChild(canvas);
        outputDiv.appendChild(p);
      }
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script>
<button class="btn btn-default btn-webr" disabled="" type="button" id="webr-run-button-4">
Loading webR…
</button>
<div id="webr-editor-4">

</div>
<div id="webr-code-output-4">
<pre style="visibility: hidden"></pre>
</div>
<script type="module">
  const runButton = document.getElementById('webr-run-button-4');
  const outputDiv = document.getElementById('webr-code-output-4');
  const editorDiv = document.getElementById('webr-editor-4');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# Rasters with negative width or height are now correctly\n# drawn mirrored and flipped.\ninstall.packages("jpeg")\nlogo = jpeg::readJPEG(system.file(package = "jpeg", "img", "Rlogo.jpg"))\nplot(NULL, xlab = "", ylab = "", xlim = c(0, 1), ylim = c(0, 1))\n\nrasterImage(logo, xleft = 0.2, xright = 0.5, ybottom = 0.5, ytop = 1)\nrasterImage(logo, xleft = 0.8, xright = 0.5, ybottom = 0.5, ytop = 1)\nrasterImage(logo, xleft = 0.2, xright = 0.5, ybottom = 0.5, ytop = 0)\nrasterImage(logo, xleft = 0.8, xright = 0.5, ybottom = 0.5, ytop = 0)`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await globalThis.webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=360)');
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: webR.objs.emptyEnv,
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      const msgs = await webR.flush();
      console.log(msgs)
      msgs.forEach(msg => {
        if (msg.type === 'canvas' && msg.data.event === 'canvasImage'){
          if (!canvas) {
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 360);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
          }
          canvas.getContext('2d').drawImage(msg.data.image, 0,0,canvas.width,canvas.height)
        }
      });

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      if (canvas) {
        const p = document.createElement("p");
        p.appendChild(canvas);
        outputDiv.appendChild(p);
      }
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script>
</section>
</section>
<section id="the-r-object-interface" class="level2">
<h2 class="anchored" data-anchor-id="the-r-object-interface">The R object interface</h2>
<p>The R object interface provided by webR has been expanded to support the conversion of more types of JavaScript objects into R objects. Such conversions are automatically applied when interacting with the R environment from JavaScript.</p>
<section id="raw-vectors" class="level3">
<h3 class="anchored" data-anchor-id="raw-vectors">Raw vectors</h3>
<p>JavaScript objects of type <code>TypedArray</code>, <code>ArrayBuffer</code>, and <code>ArrayBufferView</code> (e.g.&nbsp;<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code>Uint8Array</code></a>) may now be used to construct R objects. By default, objects of this type are converted to R raw atomic vectors. This simplifies the transfer of binary data to R.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> data <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint8Array</span>([<span class="dv">4</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">12</span>])<span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Print data's R object class and an example byte</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="vs">  class(data)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="vs">  data[2]</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">,</span> { <span class="dt">withAutoprint</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">env</span><span class="op">:</span> { data } })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output">
<pre><code>[1] "raw"
[1] 0c</code></pre>
</div>
</section>
<section id="r-data.frame" class="level3">
<h3 class="anchored" data-anchor-id="r-data.frame">R <code>data.frame</code></h3>
<p>JavaScript objects of shape <code>{ x: [...], y: [...] }</code>, with data in a “long” column-based form, can now be used to construct R objects. In previous versions of webR, this object shape was reserved for future use. However, with this release webR now constructs an R <code>data.frame</code> by taking the source object’s properties as column vectors. The resulting <code>data.frame</code> can then be manipulated from R in the usual way:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> data <span class="op">=</span> { <span class="dt">column_x</span><span class="op">:</span> [<span class="st">"foo"</span><span class="op">,</span> <span class="st">"bar"</span><span class="op">,</span> <span class="st">"baz"</span>]<span class="op">,</span> <span class="dt">column_y</span><span class="op">:</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">7</span>] }</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="vs">  class(data)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="vs">  colnames(data)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="vs">  data[2:3,]</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">,</span> { <span class="dt">withAutoprint</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">env</span><span class="op">:</span> { data } })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output">
<pre><code>[1] "data.frame"
[1] "column_x" "column_y"
        column_x column_y
 2      bar        3
 3      baz        7</code></pre>
</div>
<p>Similarly, an R <code>data.frame</code> can be converted back into a JavaScript object of this form:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cars <span class="op">=</span> <span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`mtcars`</span>)<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> cars<span class="op">.</span><span class="fu">toObject</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output">
<pre><code>{
  am: [1, 1, 1, ..., 1],
  carb: [4, 4, 1, ..., 2],
  cyl: [6, 6, 4, ..., 4]
  ...,
  wt: [2.62, 2.875, 2.32, ..., 2.78],
}</code></pre>
</div>
</section>
<section id="d3-wide-format" class="level3">
<h3 class="anchored" data-anchor-id="d3-wide-format">D3 “wide” format</h3>
<p>In JavaScript, particularly when using frameworks built upon <a href="https://d3js.org">D3</a>, it is typical to work with data in a “wide” form: an array of objects per row, each including all the column names and values. With this release, webR can also convert JavaScript objects in this form into an R <code>data.frame</code>.</p>
<p>The following example loads the same data as shown in the previous example but expressed in the “wide” form.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">column_x</span><span class="op">:</span> <span class="st">"foo"</span><span class="op">,</span> <span class="dt">column_y</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">column_x</span><span class="op">:</span> <span class="st">"bar"</span><span class="op">,</span> <span class="dt">column_y</span><span class="op">:</span> <span class="dv">3</span> }<span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">column_x</span><span class="op">:</span> <span class="st">"baz"</span><span class="op">,</span> <span class="dt">column_y</span><span class="op">:</span> <span class="dv">7</span> }<span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="vs">  class(data)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="vs">  colnames(data)</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="vs">  data[2:3,]</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">,</span> { <span class="dt">withAutoprint</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">env</span><span class="op">:</span> { data } })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output">
<pre><code>[1] "data.frame"
[1] "column_x" "column_y"
        column_x column_y
 2      bar        3
 3      baz        7</code></pre>
</div>
<p>An R <code>data.frame</code> can also be converted into a D3 compatible JavaScript object:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cars <span class="op">=</span> <span class="cf">await</span> webR<span class="op">.</span><span class="fu">evalR</span>(<span class="vs">`mtcars`</span>)<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> cars<span class="op">.</span><span class="fu">toD3</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output">
<pre><code>[
  { mpg: 21, cyl: 6, disp: 160, ... },
  { mpg: 21, cyl: 6, disp: 160, ... },
  { mpg: 22.8, cyl: 4, disp: 108, ...},
  ...
  { mpg: 21.4, cyl: 4, disp: 121, ...},
]</code></pre>
</div>
</section>
</section>
<section id="webassembly-toolchain-upgrades" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="webassembly-toolchain-upgrades">WebAssembly toolchain upgrades</h2>
<p>We have updated our WebAssembly build system, upgrading the <a href="https://emscripten.org">Emscripten</a> C/C++ compiler to version 3.1.47 and the <a href="https://flang.llvm.org/docs/">LLVM Flang</a> Fortran compiler to be based on LLVM 18.1.1. As part of the work, webR now supports building under Nix using <a href="https://nixos.wiki/wiki/Flakes">flakes</a>, suggested and largely implemented by <a href="https://github.com/wch"><span class="citation" data-cites="wch">@wch</span></a>.</p>
<p>With this, source-code level reproducible builds of the webR WebAssembly binaries can be made, strengthening the argument for webR as a potential future platform for reproducible data science.</p>
<section id="llvm-flang" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="llvm-flang">LLVM Flang</h3>
<p>To compile Fortran sources in the R source code<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> for webR, we require a Fortran compiler that supports outputting WebAssembly objects. This is a surprisingly tricky business, and our current solution is to maintain a patched version of LLVM’s <code>flang-new</code> compiler frontend.</p>
<div class="no-row-height column-margin column-container"><p><sup>2</sup>&nbsp;There are also many R packages containing Fortran source code.</p></div><p>In recent months, the patches we must make to LLVM Flang have become smaller and easier to manage as the LLVM team continues to improve the Flang frontend. While too long for this post, for those interested in exactly what changes we make to enable WebAssembly output, I have written a deep-dive blog post, <a href="https://gws.phd/posts/fortran_wasm/">Fortran on WebAssembly</a>.</p>
</section>
</section>
<section id="additional-system-libraries-and-rust-support" class="level2">
<h2 class="anchored" data-anchor-id="additional-system-libraries-and-rust-support">Additional system libraries and Rust support</h2>
<p>Thanks to some great work by <a href="https://github.com/jeroen"><span class="citation" data-cites="jeroen">@jeroen</span></a> and <a href="https://github.com/yutannihilation"><span class="citation" data-cites="yutannihilation">@yutannihilation</span></a>, this release of webR includes some additional WebAssembly system libraries and software in the webR Docker container. This includes numerical libraries such as <a href="https://www.gnu.org/software/gsl/">GSL</a> and <a href="https://gmplib.org">GMP</a>, image manipulation tools such as <a href="https://imagemagick.org/">ImageMagick</a>, and a Rust compiler configured to build WebAssembly R packages containing Rust source code.</p>
<p>A demonstration R package containing Rust code, compatible with webR, can be found at <a href="https://github.com/yutannihilation/savvy-webr-test/" class="uri">https://github.com/yutannihilation/savvy-webr-test/</a>.</p>
<p>An example Shiny app making use of the WebAssembly compiled ImageMagick library is shown below, with the source code at <a href="https://github.com/jeroen/shinymagick" class="uri">https://github.com/jeroen/shinymagick</a>.</p>
<iframe style="border: 1px solid black;" width="100%" height="550px" src="https://georgestagg.github.io/shinymagick/">
</iframe>
</section>
<section id="webassembly-r-package-binaries" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="webassembly-r-package-binaries">WebAssembly R package binaries</h2>
<p>With the introduction of additional system libraries and changes to the WebAssembly toolchain, the default webR package repository has also been refreshed. The repository tends to follow CRAN package releases, though is updated less frequently. <strong>19452</strong> WebAssembly R packages have been recompiled from source for this release, with <strong>12969</strong> packages, about 63% of CRAN, fully available<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> for use in webR.</p>
<div class="no-row-height column-margin column-container"><p><sup>3</sup>&nbsp;Here “available” means that both a binary build of an R package and all of its dependencies can be downloaded from the repository.</p></div><p>As my usual caveat goes, we have not been able to test all the available packages. Feel free to try your favourite package in the <a href="https://webr.r-wasm.org/v0.3.1/">webR app</a> and let us know in a <a href="https://github.com/r-wasm/webr/issues">GitHub issue</a> if there is a problem.</p>
<p>The <a href="https://repo.r-wasm.org">package repository index</a> contains further information and a searchable list of WebAssembly R packages. In addition, <a href="https://r-universe.dev">R-Universe</a> also builds webR-compatible binaries and so can be used as an alternative repository for access to even more R packages.</p>
<section id="building-custom-webassembly-r-packages" class="level3">
<h3 class="anchored" data-anchor-id="building-custom-webassembly-r-packages">Building custom WebAssembly R packages</h3>
<p>If you’d like to build your own R packages for webR, the <a href="https://r-wasm.github.io/rwasm/">rwasm</a> package provides functions to help compile R packages for WebAssembly, manage repositories, and prepare webR-compatible filesystem images.</p>
<p>We’ve also started building <a href="https://github.com/r-wasm/actions/">reusable workflows for GitHub Actions</a>. If you have an R package with source code hosted on GitHub, an action can be added to your repository such that a WebAssembly version of your package will be built automatically by a GitHub runner on package release.</p>
</section>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>Thank you, as always, to the users and developers contributing to webR in the form of discussion in issues, bug reports, and pull requests.</p>
<p><a href="https://github.com/adrianolszewski"><span class="citation" data-cites="adrianolszewski">@adrianolszewski</span></a>, <a href="https://github.com/christianp"><span class="citation" data-cites="christianp">@christianp</span></a>, <a href="https://github.com/coatless"><span class="citation" data-cites="coatless">@coatless</span></a>, <a href="https://github.com/ColinFay"><span class="citation" data-cites="ColinFay">@ColinFay</span></a>, <a href="https://github.com/drgomulka"><span class="citation" data-cites="drgomulka">@drgomulka</span></a>, <a href="https://github.com/erex"><span class="citation" data-cites="erex">@erex</span></a>, <a href="https://github.com/gitdemont"><span class="citation" data-cites="gitdemont">@gitdemont</span></a>, <a href="https://github.com/gorkang"><span class="citation" data-cites="gorkang">@gorkang</span></a>, <a href="https://github.com/isbool"><span class="citation" data-cites="isbool">@isbool</span></a>, <a href="https://github.com/JeremyPasco"><span class="citation" data-cites="JeremyPasco">@JeremyPasco</span></a>, <a href="https://github.com/jeroen"><span class="citation" data-cites="jeroen">@jeroen</span></a>, <a href="https://github.com/JosiahParry"><span class="citation" data-cites="JosiahParry">@JosiahParry</span></a>, <a href="https://github.com/Luke-Symes-Tsy"><span class="citation" data-cites="Luke-Symes-Tsy">@Luke-Symes-Tsy</span></a>, <a href="https://github.com/maek-ies"><span class="citation" data-cites="maek-ies">@maek-ies</span></a>, <a href="https://github.com/MaybeJustJames"><span class="citation" data-cites="MaybeJustJames">@MaybeJustJames</span></a>, <a href="https://github.com/ravinder387"><span class="citation" data-cites="ravinder387">@ravinder387</span></a>, <a href="https://github.com/StaffanBetner"><span class="citation" data-cites="StaffanBetner">@StaffanBetner</span></a>, <a href="https://github.com/SugarRayLua"><span class="citation" data-cites="SugarRayLua">@SugarRayLua</span></a>, <a href="https://github.com/takahser"><span class="citation" data-cites="takahser">@takahser</span></a>, <a href="https://github.com/tim-newans"><span class="citation" data-cites="tim-newans">@tim-newans</span></a>, <a href="https://github.com/timelyportfolio"><span class="citation" data-cites="timelyportfolio">@timelyportfolio</span></a>, <a href="https://github.com/tstubbs-evolution"><span class="citation" data-cites="tstubbs-evolution">@tstubbs-evolution</span></a>, <a href="https://github.com/yhm-amber"><span class="citation" data-cites="yhm-amber">@yhm-amber</span></a>, <a href="https://github.com/yii-iiy"><span class="citation" data-cites="yii-iiy">@yii-iiy</span></a>, <a href="https://github.com/yutannihilation"><span class="citation" data-cites="yutannihilation">@yutannihilation</span></a>, and <a href="https://github.com/zhangwenda0518"><span class="citation" data-cites="zhangwenda0518">@zhangwenda0518</span></a>.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>